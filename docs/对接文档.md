# AdvanceSDK对接文档-Android

本文档位聚合sdk接入配置文档，用户可以参考该文档根据添加相应的sdk配置项。

用户可以参考BayesAdvanceSdkDemo工程中的配置以及广告位接入代码，进行开发。

目前聚合SDK支持管理的广告位类型为：

- 横幅广告位(Banner)： 广点通Banner2.0类型，穿山甲，倍业

- 开屏广告位(Splash)：广点通，穿山甲，倍业

- 原生自渲染广告位(Native):广点通，穿山甲，倍业

- 原生模板信息流广告位(NativeExpress): 广点通，穿山甲

- 激励视频(RewardVideo)：广点通，穿山甲

  

## 1.聚合SDK工作流程

![](sequence.png)



## 1.SDK包导入

在工程中创建一个libs目录，拷贝集成SDK需要的库文件(请使用提供的sdk包保证版本一致)：

advancelib.aar(聚合SDK包)

bayessdk.jar

GDTSDK.union.4.80.950.aar

open_ad_sdk.aar  (穿山甲v2.0.1.7)

android-gif-drawable-1.2.6.aar (穿山甲sdk需要)

在工程的build.gradle中引入这些库，具体配置可以参考BayesAdvanceSdkDemo工程的build.gradle设置。

```groovy
repositories {
    flatDir {
        dirs 'libs'
    }
}
implementation(name: 'advancelib', ext: 'aar')
implementation(name: 'GDTSDK.union.4.80.950', ext: 'aar')
implementation(name: 'open_ad_sdk', ext: 'aar')
implementation(name: 'android-gif-drawable-1.2.6',ext: 'aar')
implementation files('libs/bayessdk.jar')
implementation 'com.android.support:support-v4:28.0.0'
```

```
为了适配穿山甲SDK下载和安装相关功能，在工程中引用的包 com.android.support:support-v4:24.2.0 
使用24.2.0以及以上版本。
```

## 2.SDK相关权限申请

要保证SDK能够正常工作需要申请必要的权限，如果targetSdkVersion>23还需要动态申请相关权限，具体实现可参见Demo工程 SplashActivity.java。

```Xml
<uses-permission android:name="android.permission.INTERNET" />
<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
<uses-permission android:name="android.permission.ACCESS_WIFI_STATE" />
<uses-permission android:name="android.permission.READ_PHONE_STATE" />
<uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />
<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />    <!-- 如果需要精确定位的话请加上此权限 -->
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.REQUEST_INSTALL_PACKAGES" />
<!--穿山甲相关-->
<uses-permission android:name="android.permission.GET_TASKS"/>
<!-- 如果有视频相关的广告且使用textureView播放，请务必添加，否则黑屏 -->
<uses-permission android:name="android.permission.WAKE_LOCK" />

```

## 3.AndroidManifest.xml配置

如果您打包 App 时的 targetSdkVersion >= 28：在AndroidManifest.xml 添加依赖声明 `uses-library android:name="org.apache.http.legacy" android:required="false"`
在application标签中添加 `android:usesCleartextTraffic="true"`，否则 SDK 无法工作，示例如下：

```xml
<application
    android:name=".DemoApplication"
    android:icon="@drawable/gdticon"
    android:label="@string/app_name"
    android:theme="@style/AppTheme"
    android:usesCleartextTraffic="true">

    <uses-library
        android:name="org.apache.http.legacy"
        android:required="false" />
    ... ...
  </application>
```

在AndroidManifest.xml中注册SDK相关的Activity和Service:

```xml
<!--广点通-->
<service 
    android:name="com.qq.e.comm.DownloadService" 
    android:exported="false" />
<activity 
    android:name="com.qq.e.ads.ADActivity" 
    android:configChanges="keyboard|keyboardHidden|orientation|screenSize" />
<activity 
    android:name="com.qq.e.ads.PortraitADActivity" 
    android:screenOrientation="portrait" 
    android:configChanges="keyboard|keyboardHidden|orientation|screenSize" />
<activity 
    android:name="com.qq.e.ads.LandscapeADActivity" 
    android:screenOrientation="landscape" 
    android:configChanges="keyboard|keyboardHidden|orientation|screenSize" />
<!--倍业-->
<activity
    android:name="com.bayescom.sdk.BayesActivity"
    android:configChanges="keyboard|keyboardHidden|orientation|screenSize" />
<service android:name="com.bayescom.sdk.BayesDownloadService" />

```

针对Andriod7.0以上文件访问兼容性配置，在AndroidManifest.xml中增加：

```xml
<!--穿山甲-->
<provider
    android:name="com.bytedance.sdk.openadsdk.TTFileProvider"
    android:authorities="${applicationId}.TTFileProvider"
    android:exported="false"
    android:grantUriPermissions="true">
   <meta-data
        android:name="android.support.FILE_PROVIDER_PATHS"
        android:resource="@xml/file_paths" />
</provider>
<provider
    android:name="com.bytedance.sdk.openadsdk.multipro.TTMultiProvider"
    android:authorities="${applicationId}.TTMultiProvider"
    android:exported="false" />
<!--广点通，倍业-->
 <provider
        android:name="android.support.v4.content.FileProvider"
        android:authorities="${applicationId}.fileprovider"
        android:exported="false"
        android:grantUriPermissions="true">
        <meta-data
            android:name="android.support.FILE_PROVIDER_PATHS"
            android:resource="@xml/file_path" />
    </provider>
```

在res/xml目录下，新建穿山甲xml文件file_paths.xml，在该文件中添加如下代码：

```xml
<?xml version="1.0" encoding="utf-8"?>  
<paths xmlns:android="http://schemas.android.com/apk/res/android">  
   <external-files-path name="external_files_path" path="Download" />  
    <!--为了适配所有路径可以设置 path = "." -->  
</paths>
```

在res/xml目录下，新建广点通，倍业的兼容配置file_path.xml,在文件中添加如下代码:

```xml
<paths xmlns:android="http://schemas.android.com/apk/res/android">
    <!-- 这个下载路径也不可以修改，必须为GDTDOWNLOAD -->
    <external-path
        name="gdt_sdk_download_path"
        path="GDTDOWNLOAD" />
    <external-files-path
        name="external_files_path"
        path="Download" />
    <external-path
        name="download"
        path="." />
    <external-cache-path
        name="gdt_sdk_download_path1"
        path="com_qq_e_download" />
    <cache-path
        name="gdt_sdk_download_path2"
        path="com_qq_e_download" />
</paths>
```

## 4.代码混淆配置

如果您需要使用proguard混淆代码，需确保不要混淆SDK的代码。 请在proguard.cfg文件(或其他混淆文件)尾部添加如下配置:

```
-keep class com.bytedance.sdk.openadsdk.** { *; }
-keep public interface com.bytedance.sdk.openadsdk.downloadnew.** {*;}
-keep class com.ss.sys.ces.* {*;}
-keep class com.bayescom.sdk.**{
  public protected *;
}
-keep class com.qq.e.** { 
    public protected *; 
}
-keep class android.support.v4.app.NotificationCompat**{
    public *;
}

```

## 5.广告位接入代码示例

具体可运行的代码可以参考BayesAdvanceDemo工程。

app启动时可以设置聚合SDK相关设置：

```java
public class MainActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        //设置SDK配置
        AdvanceConfig.getInstance().setAppName("测试app");
        AdvanceConfig.getInstance().setDebug(true);
        
    }
}  
```

### 5.1横幅(Banner)

支持广点通，穿山甲，倍业横幅广告位。

```java
public class BannerActivity extends AppCompatActivity implements AdvanceBannerListener {
    private AdvanceBanner advanceBanner;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_banner);
        RelativeLayout rl = findViewById(R.id.banner_layout);//广告容器
        advanceBanner = new AdvanceBanner(this,rl,Constants.mediaId,Constants.bannerAdspotId);
        advanceBanner.setCsjAcceptedSize(640,100) //设置穿山甲SDK接受图片大小
                     .setRefreshInterval(60)//设置刷新频率
                     .setAdListener(this);//设置广告监听
        advanceBanner.setDefaultSdkSupplier(new SdkSupplier("100171","10000396","e1d0d3aaf95d3f1980367e75bc41141d",AdvanceConfig.SDK_TAG_BAYES));
      //设置默认打底sdk的配置参数，可以为穿山甲，广点通，倍业，策略服务器不响应就出打底广告，所有广告位都可以设置
        advanceBanner.loadAd();//加载广告


    }

    @Override
    public void onAdShow() {
        Log.d(TAG,"SHOW");
        Toast.makeText(this,"广告展现",Toast.LENGTH_SHORT).show();

    }

    @Override
    public void onAdFailed() {

        Log.d(TAG,"Failed");
        Toast.makeText(this,"广告失败",Toast.LENGTH_SHORT).show();

    }

    @Override
    public void onAdClicked() {
        Log.d(TAG,"Clicked");
        Toast.makeText(this,"广告点击",Toast.LENGTH_SHORT).show();

    }

    @Override
    public void onDislike() {
      //点击了关闭按钮，可以移除横幅广告
        RelativeLayout rl = findViewById(R.id.banner_layout);
        rl.removeAllViews();
        Toast.makeText(this,"广告关闭",Toast.LENGTH_SHORT).show();

    }

    @Override
    public void onDestroy()
    {
        //需要调用destroy回收广告资源
        super.onDestroy();
        advanceBanner.destroy();

    }
}
```

### 5.2开屏(Splash)

支持广点通，穿山甲，倍业开屏广告位。

```java
public class SplashActivity extends AppCompatActivity implements AdvanceSplashListener,WeakHandler.IHandler {
    private AdvanceSplash advanceSplash;
    private final WeakHandler mHandler = new WeakHandler(this);
    private static final int MSG_GO_MAIN = 1;
    private boolean canJump=false;//跳转控制变量


    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_splash);
        FrameLayout adContainer = findViewById(R.id.splash_container);//开屏广告容器
        TextView skipView = findViewById(R.id.skip_view);//跳过按钮

        advanceSplash = new AdvanceSplash(this, Constants.mediaId, Constants.splashAdspotId, adContainer, skipView);
        advanceSplash.setSkipText("%d s|跳过")//跳过文字
                .setCsjAcceptedSize(1080, 1920)//设置穿山甲广告图片偏好尺寸(如果介入穿山甲的话
                .setAdListener(this);
        // 如果targetSDKVersion >= 23，就要申请好权限。如果您的App没有适配到Android6.0（即targetSDKVersion < 23），那么只需要在这里直接调用fetchSplashAD接口。
        if (Build.VERSION.SDK_INT >= 23) {
            checkAndRequestPermission();
        } else {
            advanceSplash.loadAd();
        }

    }

    @Override
    public void onAdShow() {
        Log.d("DEMO", "Splash ad show");
        Toast.makeText(this,"广告展示成功",3).show();
    }

    @Override
    public void onAdFailed() {
        Log.d("DEMO", "Splash ad failed");
        Toast.makeText(this,"广告加载失败",3).show();
        goToMainActivity();


    }

    @Override
    public void onAdClicked() {
        Log.d("DEMO", "Splash ad clicked");
        Toast.makeText(this,"广告点击",3).show();

    }

    @Override
    public void onAdClose() {
        Log.d("DEMO", "Splash ad closed");
        Toast.makeText(this,"广告关闭",3).show();
        mHandler.sendEmptyMessageDelayed(MSG_GO_MAIN,500);
    }

    /**
     * ----------非常重要----------
     * <p>
     * Android6.0以上的权限适配简单示例：
     * <p>
     * 如果targetSDKVersion >= 23，那么必须要申请到所需要的权限，再调用广点通SDK，否则广点通SDK不会工作。
     * <p>
     * Demo代码里是一个基本的权限申请示例，请开发者根据自己的场景合理地编写这部分代码来实现权限申请。
     * 注意：下面的`checkSelfPermission`和`requestPermissions`方法都是在Android6.0的SDK中增加的API，如果您的App还没有适配到Android6.0以上，则不需要调用这些方法，直接调用广点通SDK即可。
     */
    @TargetApi(Build.VERSION_CODES.M)
    private void checkAndRequestPermission() {
        List<String> lackedPermission = new ArrayList<String>();
        if (!(checkSelfPermission(Manifest.permission.READ_PHONE_STATE) == PackageManager.PERMISSION_GRANTED)) {
            lackedPermission.add(Manifest.permission.READ_PHONE_STATE);
        }

        if (!(checkSelfPermission(Manifest.permission.WRITE_EXTERNAL_STORAGE) == PackageManager.PERMISSION_GRANTED)) {
            lackedPermission.add(Manifest.permission.WRITE_EXTERNAL_STORAGE);
        }

        if (!(checkSelfPermission(Manifest.permission.ACCESS_FINE_LOCATION) == PackageManager.PERMISSION_GRANTED)) {
            lackedPermission.add(Manifest.permission.ACCESS_FINE_LOCATION);
        }

        // 权限都已经有了，那么直接调用SDK
        if (lackedPermission.size() == 0) {
            advanceSplash.loadAd();

        } else {
            // 请求所缺少的权限，在onRequestPermissionsResult中再看是否获得权限，如果获得权限就可以调用SDK，否则不要调用SDK。
            String[] requestPermissions = new String[lackedPermission.size()];
            lackedPermission.toArray(requestPermissions);
            requestPermissions(requestPermissions, 1024);
        }
    }

    private boolean hasAllPermissionsGranted(int[] grantResults) {
        for (int grantResult : grantResults) {
            if (grantResult == PackageManager.PERMISSION_DENIED) {
                return false;
            }
        }
        return true;
    }

    @Override
    public void onRequestPermissionsResult(int requestCode, String[] permissions, int[] grantResults) {
        super.onRequestPermissionsResult(requestCode, permissions, grantResults);
        if (requestCode == 1024 && hasAllPermissionsGranted(grantResults)) {
            advanceSplash.loadAd();

        } else {
            // 如果用户没有授权，那么应该说明意图，引导用户去设置里面授权。
            Toast.makeText(this, "应用缺少必要的权限！请点击\"权限\"，打开所需要的权限。", Toast.LENGTH_LONG).show();
            Intent intent = new Intent(Settings.ACTION_APPLICATION_DETAILS_SETTINGS);
            intent.setData(Uri.parse("package:" + getPackageName()));
            startActivity(intent);
            finish();
        }
    }
    /**
     * 设置一个变量来控制当前开屏页面是否可以跳转，当开屏广告为普链类广告时，点击会打开一个广告落地页，此时开发者还不能打开自己的App主页。当从广告落地页返回以后，
     * 才可以跳转到开发者自己的App主页；当开屏广告是App类广告时只会下载App。
     */
    private void next() {
        if (canJump) {
            goToMainActivity();
        } else {
            canJump = true;
        }
    }

    @Override
    protected void onPause() {
        super.onPause();
        canJump = false;
    }

    @Override
    protected void onResume() {
        super.onResume();
        if (canJump) {
            next();
        }
        canJump = true;
    }


    @Override
    protected void onDestroy() {
        super.onDestroy();
        mHandler.removeCallbacksAndMessages(null);
    }

    /**
     * 开屏页一定要禁止用户对返回按钮的控制，否则将可能导致用户手动退出了App而广告无法正常曝光和计费
     */
    @Override
    public boolean onKeyDown(int keyCode, KeyEvent event) {
        if (keyCode == KeyEvent.KEYCODE_BACK || keyCode == KeyEvent.KEYCODE_HOME) {
            return true;
        }
        return super.onKeyDown(keyCode, event);
    }
    /**
     * 跳转到主页面
     */
    private void goToMainActivity() {
        Intent intent = new Intent(SplashActivity.this, MainActivity.class);
        startActivity(intent);
        this.finish();
    }
    @Override
    public void handleMsg(Message msg) {
        if (msg.what == MSG_GO_MAIN) {
            next();
        }
    }
```

### 5.3原生模板(NativeExpress)

支持广点通，穿山甲原生模板广告位。广告数据加载后需要转换为：GdtNativeAdExpressAdItem或者CsjNativeExpressAdItem包装类进行操作，包装类包装了原始的广点通和穿山甲模板广告位API。

RecyclerView中使用的话请参考示例工程。

```java
public class NativeExpressActivity extends AppCompatActivity implements AdvanceNativeExpressListener {
    private AdvanceNativeExpress advanceNativeExpress;
    private FrameLayout container;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_native_express);
        container = findViewById(R.id.native_express_container);
        advanceNativeExpress = new AdvanceNativeExpress(this, Constants.mediaId, Constants.nativeExpressAdspotId);
        advanceNativeExpress.setExpressViewAcceptedSize(600,300) //设置广告View大小
                .setCsjImageAcceptedSize(640,320)//设置穿山甲SDK可接受图片大小
                .setGdtMaxVideoDuration(60)//设置广点通最长视频时间长途
                .setGdtAutoHeight(true)//设置广点通是否使用自动高度
                .setGdtFullWidth(true);//设置广点通广告位宽度是否全屏
        advanceNativeExpress.setAdListener(this);//设置广告监听器
        advanceNativeExpress.loadAd();
    }

    @Override
    public void onAdShow() {
        Toast.makeText(this,"广告展示",Toast.LENGTH_SHORT).show();

        Log.d("DEMO", "SHOW");
    }

    @Override
    public void onAdFailed() {
        Toast.makeText(this,"广告失败",Toast.LENGTH_SHORT).show();
        Log.d("DEMO", "FAILED");

    }

    @Override
    public void onAdClicked() {
        Toast.makeText(this,"广告点击",Toast.LENGTH_SHORT).show();
        Log.d("DEMO", "CLICKED");

    }

    @Override
    public void onAdClose(View view) {

        Toast.makeText(this,"广告关闭",Toast.LENGTH_SHORT).show();
        Log.d("DEMO", "CLOSED");
    }

    @Override
    public void onAdLoaded(List<AdvanceNativeExpressAdItem> list) {
        Toast.makeText(this,"广告加载成功",Toast.LENGTH_SHORT).show();
        Log.d("DEMO", "LOADED");
        if (null == list && list.isEmpty()) {
            return;
        } else {
            AdvanceNativeExpressAdItem advanceNativeExpressAdItem = list.get(0);
                if (advanceNativeExpressAdItem.getSdkTag().equals(AdvanceConfig.SDK_TAG_GDT)) {
                  //转换为广点通广告模板对象
                    GdtNativeAdExpressAdItem gdtNativeAdExpressAdItem = (GdtNativeAdExpressAdItem) advanceNativeExpressAdItem;
                  //加载了广点通广告，渲染广点通广告模板
                        renderGdtExpressAd(gdtNativeAdExpressAdItem);
                } else if (advanceNativeExpressAdItem.getSdkTag().equals(AdvanceConfig.SDK_TAG_CSJ)) {
                  //转换为穿山甲广告模板对象
                    CsjNativeExpressAdItem csjNativeExpressAdItem = (CsjNativeExpressAdItem)  advanceNativeExpressAdItem;
                  //加载了穿山甲广告//渲染穿山甲广告模板
                        renderCsjExpressAd(csjNativeExpressAdItem);

                }

        }

    }

    public void renderGdtExpressAd(GdtNativeAdExpressAdItem gdtNativeAdExpressAdItem) {
        container.removeAllViews();
        container.setVisibility(View.VISIBLE);
        if (gdtNativeAdExpressAdItem.getBoundData().getAdPatternType() == AdPatternType.NATIVE_VIDEO) {
            gdtNativeAdExpressAdItem.setMediaListener(new NativeExpressMediaListener() {
                @Override
                public void onVideoInit(NativeExpressADView nativeExpressADView) {

                }

                @Override
                public void onVideoLoading(NativeExpressADView nativeExpressADView) {

                }

                @Override
                public void onVideoReady(NativeExpressADView nativeExpressADView, long l) {

                }

                @Override
                public void onVideoStart(NativeExpressADView nativeExpressADView) {

                }

                @Override
                public void onVideoPause(NativeExpressADView nativeExpressADView) {

                }

                @Override
                public void onVideoComplete(NativeExpressADView nativeExpressADView) {

                }

                @Override
                public void onVideoError(NativeExpressADView nativeExpressADView, AdError adError) {

                }

                @Override
                public void onVideoPageOpen(NativeExpressADView nativeExpressADView) {

                }

                @Override
                public void onVideoPageClose(NativeExpressADView nativeExpressADView) {

                }
            });
        }
        // 广告可见才会产生曝光，否则将无法产生收益。
        container.addView(gdtNativeAdExpressAdItem.getNativeExpressADView());
        gdtNativeAdExpressAdItem.render();


    }

    public void renderCsjExpressAd(CsjNativeExpressAdItem csjNativeExpressAdItem) {
        csjNativeExpressAdItem.setExpressInteractionListener(new TTNativeExpressAd.ExpressAdInteractionListener() {
            @Override
            public void onAdClicked(View view, int type) {
                Log.d("DEMO","CLICKED");
            }

            @Override
            public void onAdShow(View view, int type) {
                Log.d("DEMO","SHOW");

            }

            @Override
            public void onRenderFail(View view, String msg, int code) {
                Log.d("DEMO","RENDER FAILED");
            }

            @Override
            public void onRenderSuccess(View view, float width, float height) {
                container.removeAllViews();
                container.setVisibility(View.VISIBLE);
                container.addView(view);
            }
        });
        csjNativeExpressAdItem.setDislikeCallback(this, new TTAdDislike.DislikeInteractionCallback() {
            @Override
            public void onSelected(int i, String s) {
                container.setVisibility(View.GONE);
            }
            @Override
            public void onCancel() {

            }
        });
        if(csjNativeExpressAdItem.getInteractionType()==TTAdConstant.INTERACTION_TYPE_DOWNLOAD)
        {
            csjNativeExpressAdItem.setDownloadListener(new TTAppDownloadListener() {
                @Override
                public void onIdle() {

                }

                @Override
                public void onDownloadActive(long l, long l1, String s, String s1) {

                }

                @Override
                public void onDownloadPaused(long l, long l1, String s, String s1) {

                }

                @Override
                public void onDownloadFailed(long l, long l1, String s, String s1) {

                }

                @Override
                public void onDownloadFinished(long l, String s, String s1) {

                }

                @Override
                public void onInstalled(String s, String s1) {

                }
            });
        }
        csjNativeExpressAdItem.render();

    }
    @Override
    protected void onDestroy()
    {
        super.onDestroy();
    }
```

### 5.4原生自渲染(Native)

支持广点通，穿山甲，倍业原生自渲染类型广告位，开发者可以提供自定义的模板对广告素材进行渲染,获得更理想的广告展现形式。

```java
public class NativeRecyclerViewActivity extends Activity
        implements AdvanceNativeListener {

    private static final String TAG = NativeRecyclerViewActivity.class.getSimpleName();
    private AQuery mAQuery;
    private AdvanceNative mAdManager;
    private List<AdvanceNativeAdData> mAds;
    private CustomAdapter mAdapter;
    private H mHandler = new H();

    private static final int ITEM_COUNT = 50;
    private static final int FIRST_AD_POSITION = 5;
    private static final int AD_DISTANCE = 10;
    private static final int MSG_REFRESH_LIST = 1;

    private static final int TYPE_DATA = 0;
    private static final int TYPE_GDT_AD = 1;
    private static final int TYPE_CSJ_AD = 2;
    private static final int TYPE_BAYES_AD = 3;
    //穿山甲下载监听器Map
    private Map<CustomHolder, TTAppDownloadListener> mTTAppDownloadListenerMap = new WeakHashMap<>();


    @Override
    protected void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_native_recycler_view);
        initView();
        mAdManager = new AdvanceNative(this, Constants.mediaId, Constants.nativeAdspotId);
        mAdManager.setAdListener(this);
        mAdManager.setGdtMaxVideoDuration(60);
        mAdManager.loadAd();
    }

    private void initView() {
        RecyclerView recyclerView = findViewById(R.id.recycler_view);
        LinearLayoutManager manager = new LinearLayoutManager(this);
        manager.setOrientation(LinearLayoutManager.VERTICAL);
        recyclerView.setLayoutManager(manager);
        List<NormalItem> list = new ArrayList<>();
        for (int i = 0; i < ITEM_COUNT; ++i) {
            list.add(new NormalItem("No." + i + " Normal Data"));
        }
        mAdapter = new CustomAdapter(this, list);
        recyclerView.setAdapter(mAdapter);
        mAQuery = new AQuery(this);
    }


    @Override
    protected void onResume() {
        super.onResume();
        if (mAds != null) {
            for (AdvanceNativeAdData ad : mAds) {
                ad.resume();
            }
        }
    }

    @Override
    protected void onDestroy() {
        super.onDestroy();
        if (mAds != null) {
            for (AdvanceNativeAdData ad : mAds) {
                ad.destroy();
            }
        }
        mAds = null;
    }

    @Override
    public void onAdShow() {
        Toast.makeText(this, "广告展示", Toast.LENGTH_SHORT).show();
    }

    @Override
    public void onAdFailed() {

        Toast.makeText(this, "广告失败", Toast.LENGTH_SHORT).show();
    }

    @Override
    public void onAdClicked() {
        Toast.makeText(this, "广告点击", Toast.LENGTH_SHORT).show();
    }

    @Override
    public void onAdLoaded(List<AdvanceNativeAdData> list) {
        Toast.makeText(this, "广告数据加载成功", Toast.LENGTH_SHORT).show();
        mAds = list;
        mHandler.sendEmptyMessage(MSG_REFRESH_LIST);
    }

    class CustomAdapter extends RecyclerView.Adapter<CustomHolder> {

        private List<Object> mData;
        private Context mContext;
        private TreeSet mADSet = new TreeSet();

        public CustomAdapter(Context context, List list) {
            mContext = context;
            mData = list;
        }

        public void addAdToPosition(AdvanceNativeAdData advanceNativeAdData, int position) {
            if (position >= 0 && position < mData.size()) {
                mData.add(position, advanceNativeAdData);
                mADSet.add(position);
            }
        }

        @Override
        public int getItemViewType(int position) {
            if (mADSet.contains(position)) {
                AdvanceNativeAdData advanceNativeAdData = (AdvanceNativeAdData) mData.get(position);
                if (AdvanceConfig.SDK_TAG_GDT.equals(advanceNativeAdData.getSdkTag())) {
                    return TYPE_GDT_AD;
                } else if (AdvanceConfig.SDK_TAG_CSJ.equals(advanceNativeAdData.getSdkTag())) {
                    return TYPE_CSJ_AD;
                } else {
                    return TYPE_BAYES_AD;
                }

            } else {
                return TYPE_DATA;
            }
        }

        @Override
        public CustomHolder onCreateViewHolder(ViewGroup parent, int viewType) {
            View view;
            switch (viewType) {
                case TYPE_GDT_AD:
                    view = LayoutInflater.from(mContext).inflate(R.layout.gdt_item_ad_unified, null);
                    break;
                case TYPE_CSJ_AD:
                    view = LayoutInflater.from(mContext).inflate(R.layout.csj_item_ad_unified, null);
                    break;
                case TYPE_BAYES_AD:
                    view = LayoutInflater.from(mContext).inflate(R.layout.bayes_item_ad_unified, null);
                    break;
                case TYPE_DATA:
                    view = LayoutInflater.from(mContext).inflate(R.layout.item_data, null);
                    break;

                default:
                    view = null;
            }
            return new CustomHolder(view, viewType);
        }

        @Override
        public void onBindViewHolder(CustomHolder holder, int position) {
            switch (getItemViewType(position)) {
                case TYPE_GDT_AD:
                    initGdtAdItemView(position, holder);
                    break;
                case TYPE_CSJ_AD:
                    initCsjAdItemView(position, holder);
                    break;
                case TYPE_BAYES_AD:
                    initBayesAdItemView(position, holder);
                    break;
                case TYPE_DATA:
                    holder.title.setText(((NormalItem) mData.get(position))
                            .getTitle());
                    break;
            }
        }

        private void initGdtAdItemView(int position, final CustomHolder holder) {
            AdvanceNativeAdData advanceNativeAdData = (AdvanceNativeAdData) mData.get(position);
            //广点通原生广告数据对象
            final GdtNativeAdData ad = (GdtNativeAdData) advanceNativeAdData;
            AQuery gdtAQ = holder.gdtAQ;
            gdtAQ.id(R.id.img_logo).image(
                    TextUtils.isEmpty(ad.getIconUrl()) ? ad.getImgUrl() : ad.getIconUrl(), false, true);
            holder.name.setText(ad.getTitle());
            holder.desc.setText(ad.getDesc());
            List<View> clickableViews = new ArrayList<>();
            clickableViews.add(holder.download);
            // 视频广告
            if (ad.getAdPatternType() == AdPatternType.NATIVE_VIDEO) {
                holder.poster.setVisibility(View.INVISIBLE);
                holder.mediaView.setVisibility(View.VISIBLE);
            } else {
                holder.poster.setVisibility(View.VISIBLE);
                holder.mediaView.setVisibility(View.INVISIBLE);
            }
            ad.bindAdToView(NativeRecyclerViewActivity.this, holder.container, null,
                    clickableViews);
            gdtAQ.id(R.id.img_poster).image(ad.getImgUrl(), false, true, 0, 0,
                    new BitmapAjaxCallback() {
                        @Override
                        protected void callback(String url, ImageView iv, Bitmap bm, AjaxStatus status) {
                            if (iv.getVisibility() == View.VISIBLE) {
                                iv.setImageBitmap(bm);
                            }
                        }
                    });

            //设置广点通广告监听器(必须)
            setGdtAdListener(holder, ad);
            //更新广点通广告视图按钮文字
            updateGdtAdAction(holder.download, ad);
        }

        private void initCsjAdItemView(int position, final CustomHolder holder) {
            AdvanceNativeAdData advanceNativeAdData = (AdvanceNativeAdData) mData.get(position);
            //获取穿山甲原生广告数据对象
            final CsjNativeAdData ad = (CsjNativeAdData) advanceNativeAdData;
            AQuery csjAQ = holder.csjAQ;
            int patternType = ad.getImageMode();

            if (patternType == TTAdConstant.IMAGE_MODE_SMALL_IMG) {
                holder.csjLargeImage.setVisibility(View.GONE);
                holder.csjVerticalImage.setVisibility(View.GONE);
                holder.csjVideoView.setVisibility(View.GONE);
                holder.csjSmallImage.setVisibility(View.VISIBLE);
                holder.csjImageGroupContainer.setVisibility(View.GONE);
                if (ad.getImageList() != null && !ad.getImageList().isEmpty()) {
                    TTImage image = ad.getImageList().get(0);
                    if (image != null && image.isValid()) {
                        csjAQ.id(R.id.iv_listitem_image_small).image(image.getImageUrl(), false, true);
                    }
                }
            } else if (patternType == TTAdConstant.IMAGE_MODE_LARGE_IMG) {
                holder.csjLargeImage.setVisibility(View.VISIBLE);
                holder.csjVerticalImage.setVisibility(View.GONE);
                holder.csjVideoView.setVisibility(View.GONE);
                holder.csjSmallImage.setVisibility(View.GONE);
                holder.csjImageGroupContainer.setVisibility(View.GONE);
                if (ad.getImageList() != null && !ad.getImageList().isEmpty()) {
                    TTImage image = ad.getImageList().get(0);
                    if (image != null && image.isValid()) {
                        csjAQ.id(R.id.iv_listitem_image).image(image.getImageUrl(), false, true);
                    }
                }

            } else if (patternType == TTAdConstant.IMAGE_MODE_GROUP_IMG) {
                holder.csjLargeImage.setVisibility(View.GONE);
                holder.csjVerticalImage.setVisibility(View.GONE);
                holder.csjVideoView.setVisibility(View.GONE);
                holder.csjSmallImage.setVisibility(View.GONE);
                holder.csjImageGroupContainer.setVisibility(View.VISIBLE);

                if (ad.getImageList() != null && ad.getImageList().size() >= 3) {
                    TTImage image1 = ad.getImageList().get(0);
                    TTImage image2 = ad.getImageList().get(1);
                    TTImage image3 = ad.getImageList().get(2);
                    if (image1 != null && image1.isValid()) {
                        csjAQ.id(R.id.iv_listitem_image1).image(image1.getImageUrl(), false, false);
                    }
                    if (image2 != null && image2.isValid()) {
                        csjAQ.id(R.id.iv_listitem_image2).image(image2.getImageUrl(), false, false);
                    }
                    if (image3 != null && image3.isValid()) {
                        csjAQ.id(R.id.iv_listitem_image3).image(image3.getImageUrl(), false, false);
                    }
                }


            } else if (patternType == TTAdConstant.IMAGE_MODE_VIDEO) {

                holder.csjLargeImage.setVisibility(View.GONE);
                holder.csjVerticalImage.setVisibility(View.GONE);
                holder.csjVideoView.setVisibility(View.VISIBLE);
                holder.csjSmallImage.setVisibility(View.GONE);
                holder.csjImageGroupContainer.setVisibility(View.GONE);
                //视频广告设置播放状态回调（可选）
                ad.setVideoAdListener(new TTFeedAd.VideoAdListener() {
                    @Override
                    public void onVideoLoad(TTFeedAd ad) {
                        Log.d("DEMO","Video Loaded");

                    }

                    @Override
                    public void onVideoError(int errorCode, int extraCode) {
                        Log.d("DEMO","Video Error");

                    }

                    @Override
                    public void onVideoAdStartPlay(TTFeedAd ad) {
                        Log.d("DEMO","Video Start");

                    }

                    @Override
                    public void onVideoAdPaused(TTFeedAd ad) {
                        Log.d("DEMO","Video Paused");

                    }

                    @Override
                    public void onVideoAdContinuePlay(TTFeedAd ad) {
                        Log.d("DEMO","Video ContinuePlay");

                    }
                });
                if (holder.csjVideoView != null) {
                    //获取视频播放view,该view SDK内部渲染，在媒体平台可配置视频是否自动播放等设置。
                    View video = ad.getAdView();
                    if (video != null) {
                        if (video.getParent() == null) {
                            holder.csjVideoView.removeAllViews();
                            holder.csjVideoView.addView(video);
                        }
                    }
                }

            } else if (patternType == TTAdConstant.IMAGE_MODE_VERTICAL_IMG) {
                if (ad.getImageList() != null && !ad.getImageList().isEmpty()) {
                    TTImage image = ad.getImageList().get(0);
                    if (image != null && image.isValid()) {
                        csjAQ.id(R.id.iv_listitem_image_vertical).image(image.getImageUrl(), false, true);
                    }
                }


            }
            //绑定广告数据
            holder.csjTitle.setText(ad.getTitle()); //title为广告的简单信息提示
            holder.csjDescription.setText(ad.getDescription()); //description为广告的较长的说明
            holder.csjSource.setText(ad.getSource() == null ? "广告" : ad.getSource());
            TTImage icon = ad.getIcon();
            if (icon != null && icon.isValid()) {
                csjAQ.id(R.id.iv_listitem_icon).image(icon.getImageUrl(), false, true);

            }
            Bitmap logoBitmap = ad.getAdLogo();
            if(logoBitmap!=null)
            {
                csjAQ.id(R.id.tv_listitem_ad_logo).image(logoBitmap);
            }
            List<View> clickViewList = new ArrayList<>();
            clickViewList.add(holder.csjContainer);
            //触发创意广告的view（点击下载或拨打电话）
            List<View> creativeViewList = new ArrayList<>();
            if (null != holder.csjCreativeButton) {
                creativeViewList.add(holder.csjCreativeButton);
            }
            //如果需要点击图文区域也能进行下载或者拨打电话动作，请将图文区域的view传入
//            creativeViewList.add(adContainer);
            //重要! 这个涉及到广告计费，必须正确调用。convertView必须使用ViewGroup。
            ad.registerViewForInteraction(holder.csjContainer, clickViewList, creativeViewList, new TTNativeAd.AdInteractionListener() {
                @Override
                public void onAdClicked(View view, TTNativeAd ad) {
                    if (ad != null) {
                    }
                }

                @Override
                public void onAdCreativeClick(View view, TTNativeAd ad) {
                    if (ad != null) {
                    }
                }

                @Override
                public void onAdShow(TTNativeAd ad) {
                    if (ad != null) {
                    }
                }
            });

            switch (ad.getInteractionType()) {
                case TTAdConstant.INTERACTION_TYPE_DOWNLOAD:
                    //如果初始化ttAdManager.createAdNative(getApplicationContext())没有传入activity 则需要在此传activity，否则影响使用Dislike逻辑
                    ad.setActivityForDownloadApp(NativeRecyclerViewActivity.this);
                    holder.csjCreativeButton.setVisibility(View.VISIBLE);
                    //绑定下载状态监听器
                    bindCsjDownloadListener( holder.csjCreativeButton,holder, ad);
                    //绑定下载状态控制器（测试用途)
//                    bindCsjDownLoadStatusController(holder.csjStopButton,holder.csjRemoveButton, ad);
                    break;
                case TTAdConstant.INTERACTION_TYPE_DIAL:
                    holder.csjCreativeButton.setVisibility(View.VISIBLE);
                     holder.csjCreativeButton.setText("立即拨打");
                    break;
                case TTAdConstant.INTERACTION_TYPE_LANDING_PAGE:
                case TTAdConstant.INTERACTION_TYPE_BROWSER:
//                    adCreativeButton.setVisibility(View.GONE);
                   holder.csjCreativeButton.setVisibility(View.VISIBLE);
                   holder.csjCreativeButton.setText("查看详情");
                    break;
                default:
                   holder.csjCreativeButton.setVisibility(View.GONE);
            }



        }

        private void initBayesAdItemView(int position, final CustomHolder holder) {
            AdvanceNativeAdData advanceNativeAdData = (AdvanceNativeAdData) mData.get(position);
            //获取倍业原生广告数据对象
            final BayesNativeAdData ad = (BayesNativeAdData) advanceNativeAdData;
            AQuery bayesAQ = holder.bayesAQ;
            //需要先绑定广告容器视图和可点击View,一般为按钮，需要在容器内部，不可以是广告容器本身
            List<View> clickableViews = new ArrayList<>();
            clickableViews.add(holder.bayesDownloadButton);
            ad.bindView(holder.bayesContainer,clickableViews);
            holder.bayesTitle.setText(ad.getTitle());
            holder.bayesDescription.setText(ad.getDescription());
            String adSource= ad.getAdSource();
            if(TextUtils.isEmpty(adSource))
            {
                holder.bayesSource.setText("广告");

            }else{
                holder.bayesSource.setText(ad.getAdSource());
            }
            bayesAQ.id(R.id.img_logo).image(ad.getIcon(),false,true);
            if(ad.isAppAd())
            {
                holder.bayesDownloadButton.setText("下载");
            }else
            {
                holder.bayesDownloadButton.setText("浏览");
            }
            if(ad.getIsVideo())
            {
                holder.bayesVideoViewContainer.setVisibility(View.VISIBLE);
                holder.bayesImageGroupContainer.setVisibility(View.GONE);
                holder.bayesImageLarge.setVisibility(View.GONE);
                BayesVideoView videoView = ad.getBayesVideoView();
                if(videoView!=null)
                {
                    if(holder.bayesVideoViewContainer !=null&&videoView.getParent()==null)
                    {
                        holder.bayesVideoViewContainer.removeAllViews();
                        holder.bayesVideoViewContainer.addView(videoView);
                        ad.muteVideo();
                        ad.playVideo();
                    }else
                    {
                        ad.resumeVideo();

                    }

                }

            }else if(ad.getImageList()!=null&&ad.getImageList().size()==1)
            {
                //单图大图
                holder.bayesVideoViewContainer.setVisibility(View.GONE);
                holder.bayesImageGroupContainer.setVisibility(View.GONE);
                holder.bayesImageLarge.setVisibility(View.VISIBLE);
                bayesAQ.id(R.id.img_poster).image(ad.getImageList().get(0),false,true);

            }else if(ad.getImageList()!=null&&ad.getImageList().size()>=3)
            {
                //小图组图
                holder.bayesVideoViewContainer.setVisibility(View.GONE);
                holder.bayesImageGroupContainer.setVisibility(View.VISIBLE);
                holder.bayesImageLarge.setVisibility(View.GONE);
                bayesAQ.id(R.id.img_1).image(ad.getImageList().get(0),false,true);
                bayesAQ.id(R.id.img_2).image(ad.getImageList().get(1),false,true);
                bayesAQ.id(R.id.img_3).image(ad.getImageList().get(2),false,true);
            }
            //发送展示上报
            ad.reportAdShow();




        }
        private void bindCsjDownloadListener(final Button mCreativeButton,
                                               final CustomHolder holder, CsjNativeAdData ad) {
           TTAppDownloadListener  ttAppDownloadListener = new TTAppDownloadListener() {
                @Override
                public void onIdle() {
                    if (!isValid()) {
                        return;
                    }
                    mCreativeButton.setText("开始下载");
                }

                @SuppressLint("SetTextI18n")
                @Override
                public void onDownloadActive(long totalBytes, long currBytes, String fileName, String appName) {
                    if (!isValid()) {
                        return;
                    }
                    if (totalBytes <= 0L) {
                        mCreativeButton.setText("下载中:0%");
                    } else {
                        mCreativeButton.setText("下载中:" + (currBytes * 100 / totalBytes)+"%");
                    }
                }

                @SuppressLint("SetTextI18n")
                @Override
                public void onDownloadPaused(long totalBytes, long currBytes, String fileName, String appName) {
                    if (!isValid()) {
                        return;
                    }
                    if (totalBytes <= 0L) {
                        mCreativeButton.setText("下载暂停:0%");
                    } else {
                        mCreativeButton.setText("下载暂停:" + (currBytes * 100 / totalBytes)+"%");
                    }
                }

                @Override
                public void onDownloadFailed(long totalBytes, long currBytes, String fileName, String appName) {
                    if (!isValid()) {
                        return;
                    }
                    if (mCreativeButton != null) {
                        mCreativeButton.setText("重新下载");
                    }
                }

                @Override
                public void onInstalled(String fileName, String appName) {
                    if (!isValid()) {
                        return;
                    }
                    if (mCreativeButton != null) {
                        mCreativeButton.setText("点击打开");
                    }
                }

                @Override
                public void onDownloadFinished(long totalBytes, String fileName, String appName) {
                    if (!isValid()) {
                        return;
                    }
                    if (mCreativeButton != null) {
                        mCreativeButton.setText("点击安装");
                    }
                }

                @SuppressWarnings("BooleanMethodIsAlwaysInverted")
                private boolean isValid() {
                    return mTTAppDownloadListenerMap.get(holder) == this;
                }
            };
            //一个ViewHolder对应一个downloadListener, isValid判断当前ViewHolder绑定的listener是不是自己
            ad.setDownloadListener(ttAppDownloadListener); // 注册下载监听器
            mTTAppDownloadListenerMap.put(holder, ttAppDownloadListener);
        }

        private void setGdtAdListener(final CustomHolder holder, final GdtNativeAdData ad) {
            ad.setNativeAdEventListener(new NativeADEventListener() {
                @Override
                public void onADExposed() {
                    Log.d(TAG, "onADExposed: " + ad.getTitle());
                }

                @Override
                public void onADClicked() {
                    Log.d(TAG, "onADClicked: " + ad.getTitle());
                }

                @Override
                public void onADError(AdError error) {
                    Log.d(TAG, "onADError error code :" + error.getErrorCode()
                            + "  error msg: " + error.getErrorMsg());
                }

                @Override
                public void onADStatusChanged() {
                    updateGdtAdAction(holder.download, ad);
                }
            });
            // 视频广告
            if (ad.getAdPatternType() == AdPatternType.NATIVE_VIDEO) {
                ad.bindMediaView(holder.mediaView, null, new NativeADMediaListener() {
                    @Override
                    public void onVideoInit() {
                        Log.d(TAG, "onVideoInit: ");
                    }

                    @Override
                    public void onVideoLoading() {
                        Log.d(TAG, "onVideoLoading: ");
                    }

                    @Override
                    public void onVideoReady() {
                        Log.d(TAG, "onVideoReady: ");
                    }

                    @Override
                    public void onVideoLoaded(int videoDuration) {
                        Log.d(TAG, "onVideoLoaded: ");
                    }

                    @Override
                    public void onVideoStart() {
                        Log.d(TAG, "onVideoStart: ");
                    }

                    @Override
                    public void onVideoPause() {
                        Log.d(TAG, "onVideoPause: ");
                    }

                    @Override
                    public void onVideoResume() {
                        Log.d(TAG, "onVideoResume: ");
                    }

                    @Override
                    public void onVideoCompleted() {
                        Log.d(TAG, "onVideoCompleted: ");
                    }

                    @Override
                    public void onVideoError(AdError error) {
                        Log.d(TAG, "onVideoError: ");
                    }

                    @Override
                    public void onVideoStop() {

                    }

                    @Override
                    public void onVideoClicked() {

                    }
                });
            }
        }

        @Override
        public int getItemCount() {
            return mData.size();
        }
    }

    class CustomHolder extends RecyclerView.ViewHolder {

        public TextView title;
        public MediaView mediaView;
        public RelativeLayout adInfoContainer;
        public TextView name;
        public TextView desc;
        public ImageView logo;
        public ImageView poster;
        public Button download;
        public NativeAdContainer container;
        public AQuery gdtAQ;
        //穿山甲广告数据
        public ImageView csjSmallImage;
        public ImageView csjLargeImage;
        public ImageView csjGroupImage1;
        public ImageView csjGroupImage2;
        public ImageView csjGroupImage3;
        public ImageView csjVerticalImage;
        public FrameLayout csjVideoView;
        public TextView csjTitle;
        public TextView csjSource;
        public TextView csjDescription;
        public ImageView csjIcon;
        public Button csjCreativeButton;
        public ImageView csjLogo;
        public Button csjStopButton;
        public Button csjRemoveButton;
        public ViewGroup csjImageGroupContainer;
        public ViewGroup csjContainer;
        public AQuery csjAQ;
        //倍业广告数据
        public TextView bayesTitle;
        public TextView bayesDescription;
        public TextView bayesSource;
        public ImageView bayesIcon;
        public ImageView bayesImageLarge;
        public ImageView bayesImage1;
        public ImageView bayesImage2;
        public ImageView bayesImage3;
        public Button bayesDownloadButton;
        public FrameLayout bayesVideoViewContainer;
        public ViewGroup bayesImageGroupContainer;
        public ViewGroup bayesContainer;
        public AQuery bayesAQ;


        public CustomHolder(View itemView, int adType) {
            super(itemView);
            switch (adType) {
                case TYPE_GDT_AD:
                    mediaView = itemView.findViewById(R.id.gdt_media_view);
                    adInfoContainer = itemView.findViewById(R.id.ad_info_container);
                    logo = itemView.findViewById(R.id.img_logo);
                    poster = itemView.findViewById(R.id.img_poster);
                    name = itemView.findViewById(R.id.text_title);
                    desc = itemView.findViewById(R.id.text_desc);
                    download = itemView.findViewById(R.id.btn_download);
                    container = itemView.findViewById(R.id.native_ad_container);
                    gdtAQ = new AQuery(itemView);
                    break;
                case TYPE_CSJ_AD:
                    csjLargeImage = itemView.findViewById(R.id.iv_listitem_image);
                    csjSmallImage = itemView.findViewById(R.id.iv_listitem_image_small);
                    csjVerticalImage = itemView.findViewById(R.id.iv_listitem_image_vertical);
                    csjGroupImage1 =itemView.findViewById(R.id.iv_listitem_image1);
                    csjGroupImage2 =itemView.findViewById(R.id.iv_listitem_image2);
                    csjGroupImage3 =itemView.findViewById(R.id.iv_listitem_image3);
                    csjVideoView = itemView.findViewById(R.id.iv_listitem_video);
                    csjTitle = itemView.findViewById(R.id.tv_listitem_ad_title);
                    csjSource = itemView.findViewById(R.id.tv_listitem_ad_source);
                    csjDescription =itemView.findViewById(R.id.tv_listitem_ad_desc);
                    csjIcon = itemView.findViewById(R.id.iv_listitem_icon);
                    csjCreativeButton = itemView.findViewById(R.id.btn_listitem_creative);
                    csjLogo = itemView.findViewById(R.id.tv_listitem_ad_logo);
                    csjStopButton =itemView.findViewById(R.id.btn_listitem_stop);
                    csjRemoveButton =itemView.findViewById(R.id.btn_listitem_remove);
                    csjImageGroupContainer =itemView.findViewById(R.id.layout_image_group);
                    csjContainer =itemView.findViewById(R.id.native_ad_container);
                    csjAQ = new AQuery(itemView);
                    break;
                case TYPE_BAYES_AD:
                    bayesTitle = itemView.findViewById(R.id.text_title);
                    bayesDescription = itemView.findViewById(R.id.text_desc);
                    bayesSource = itemView.findViewById(R.id.text_adsource);
                    bayesImageLarge = itemView.findViewById(R.id.img_poster);
                    bayesImage1 = itemView.findViewById(R.id.img_1);
                    bayesImage2 = itemView.findViewById(R.id.img_2);
                    bayesImage3 = itemView.findViewById(R.id.img_3);
                    bayesIcon   = itemView.findViewById(R.id.img_logo);
                    bayesVideoViewContainer = itemView.findViewById(R.id.bayes_media_view);
                    bayesImageGroupContainer = itemView.findViewById(R.id.native_3img_ad_container);
                    bayesDownloadButton = itemView.findViewById(R.id.btn_download);
                    bayesContainer =itemView.findViewById(R.id.native_ad_container);
                    bayesAQ = new AQuery(itemView);
                    break;
                case TYPE_DATA:
                    title = itemView.findViewById(R.id.title);
                    break;

            }
        }
    }

    class NormalItem {
        private String mTitle;

        public NormalItem(String title) {
            this.mTitle = title;
        }

        public String getTitle() {
            return mTitle;
        }

    }

    private class H extends Handler {
        @Override
        public void handleMessage(Message msg) {
            switch (msg.what) {
                case MSG_REFRESH_LIST:
                    if (mAds != null && mAds.size() > 0 && mAdapter != null) {
                        for (int i = 0; i < mAds.size(); i++) {
                            mAdapter.addAdToPosition(mAds.get(i), i * AD_DISTANCE + FIRST_AD_POSITION);
                        }
                    }
                    mAdapter.notifyDataSetChanged();
                    break;

                default:
            }
        }
    }

    public static void updateGdtAdAction(Button button, GdtNativeAdData ad) {
        if (!ad.isAppAd()) {
            button.setText("浏览");
            return;
        }
        switch (ad.getAppStatus()) {
            case 0:
                button.setText("下载");
                break;
            case 1:
                button.setText("启动");
                break;
            case 2:
                button.setText("更新");
                break;
            case 4:
                button.setText(ad.getProgress() + "%");
                break;
            case 8:
                button.setText("安装");
                break;
            case 16:
                button.setText("下载失败，重新下载");
                break;
            default:
                button.setText("浏览");
                break;
        }
    }
}
```

### 5.5激励视频(RewardVideo)

支持广点通，穿山甲SDK。激励视频支持预先加载，可以在广告缓存成功后展示。广点通激励视频广告展示有过期时间，请尽快在缓存成功后展示广告。

```java
public class RewardVideoActivity extends AppCompatActivity implements AdvanceRewardVideoListener {
    private AdvanceRewardVideo advanceRewardVideo;
    private AdvanceRewardVideoItem advanceRewardVideoItem;
    private boolean isReady=false;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_reward_video);
        advanceRewardVideo = new AdvanceRewardVideo(this,Constants.mediaId,Constants.rewardAdspotId);
        //设置穿山甲相关参数(如果有的话)
        advanceRewardVideo.setCsjImageAcceptedSize(1080,1920);
        advanceRewardVideo.setCsjRewardName("金币");
        advanceRewardVideo.setOrientation(AdvanceRewardVideo.ORIENTATION_HORIZONTAL);
        advanceRewardVideo.setCsjUserId("user123");
        advanceRewardVideo.setCsjRewardAmount(3);
        //设置通用事件监听器
        advanceRewardVideo.setAdListener(this);

    }
    public void onLoad(View view)//媒体加载
    {
        isReady=false;
        advanceRewardVideo.loadAd();

    }
    public void onShow(View view)//展示
    {
        if(isReady)
        {
            if(AdvanceConfig.SDK_TAG_GDT.equals(advanceRewardVideoItem.getSdkTag()))
            {
                GdtRewardVideoAdItem gdtRewardVideoAdItem = (GdtRewardVideoAdItem) advanceRewardVideoItem;

                gdtRewardVideoAdItem.showAD();

            }else if(AdvanceConfig.SDK_TAG_CSJ.equals(advanceRewardVideoItem.getSdkTag()))
            {
                //穿山甲SDK特定设置
                CsjRewardVideoAdItem csjRewardVideoAdItem = (CsjRewardVideoAdItem)  advanceRewardVideoItem;
                //设置穿山甲SDK监听器（必须），可以监听穿山甲sdk特定回调,通用的回调同时会回调通用监听器
                csjRewardVideoAdItem.setRewardAdInteractionListener(new TTRewardVideoAd.RewardAdInteractionListener() {
                    @Override
                    public void onAdShow() {

                    }

                    @Override
                    public void onAdVideoBarClick() {

                    }

                    @Override
                    public void onAdClose() {

                    }

                    @Override
                    public void onVideoComplete() {

                    }

                    @Override
                    public void onVideoError() {

                    }

                    @Override
                    public void onRewardVerify(boolean b, int i, String s) {

                    }

                    @Override
                    public void onSkippedVideo() {

                    }
                });
                csjRewardVideoAdItem.setShowDownLoadBar(true);

                csjRewardVideoAdItem.setDownloadListener(new TTAppDownloadListener() {
                    @Override
                    public void onIdle() {

                    }

                    @Override
                    public void onDownloadActive(long l, long l1, String s, String s1) {

                    }

                    @Override
                    public void onDownloadPaused(long l, long l1, String s, String s1) {

                    }

                    @Override
                    public void onDownloadFailed(long l, long l1, String s, String s1) {

                    }

                    @Override
                    public void onDownloadFinished(long l, String s, String s1) {

                    }

                    @Override
                    public void onInstalled(String s, String s1) {

                    }
                });
                csjRewardVideoAdItem.showRewardVideoAd(this);
            }

        }else
        {
            Toast.makeText(this,"广告未加载",3).show();
        }

    }

    @Override
    public void onAdShow() {
        Log.d("DEMO","SHOW");
        Toast.makeText(this,"广告展示",3).show();

    }

    @Override
    public void onAdFailed() {
        Log.d("DEMO","FAILED");
        Toast.makeText(this,"广告加载失败",3).show();

    }

    @Override
    public void onAdClicked() {
        Log.d("DEMO","CLICKED");
        Toast.makeText(this,"广告点击",3).show();

    }

    @Override
    public void onAdLoaded(AdvanceRewardVideoItem advanceRewardVideoItem) {
        Log.d("DEMO","LOADED");
        this.advanceRewardVideoItem= advanceRewardVideoItem;
        Toast.makeText(this,"广告加载成功",3).show();


    }

    @Override
    public void onVideoCached() {
        Log.d("DEMO","CACHED");
        isReady=true;
        Toast.makeText(this,"广告缓存成功",3).show();

    }

    @Override
    public void onVideoComplete() {
        Log.d("DEMO","VIDEO COMPLETE");
        Toast.makeText(this,"视频播发完毕",3).show();

    }

    @Override
    public void onAdClose() {
        Log.d("DEMO","AD CLOSE");

        Toast.makeText(this,"广告关闭",3).show();
    }

    @Override
    public void onAdReward() {
        Log.d("DEMO","AD REWARD");
        Toast.makeText(this,"激励发放",3).show();

    }

}
```