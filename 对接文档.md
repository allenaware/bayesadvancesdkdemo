# AdvanceSDK对接文档

本文档位聚合sdk接入配置文档，用户可以参考该文档根据添加相应的sdk配置项。

用户可以参考BayesAdvanceSdkDemo工程中的配置以及广告位接入代码，进行开发。

## 1.SDK包导入

在工程中创建一个libs目录，拷贝集成SDK需要的库文件(请使用提供的sdk包保证版本一致)：

advancelib.aar

bayessdk.jar

GDTSDK.union.4.70.940.jar

open_ad_sdk.aar  (穿山甲v2.0.1.7)

android-gif-drawable-1.2.6.aar (穿山甲sdk需要)

在工程的build.gradle中引入这些库，具体配置可以参考BayesAdvanceSdkDemo工程的build.gradle设置。

```groovy
implementation(name: 'advancelib', ext: 'aar')
implementation files('libs/GDTSDK.union.4.70.940.jar')
implementation(name: 'open_ad_sdk', ext: 'aar')
implementation(name: 'android-gif-drawable-1.2.6',ext: 'aar')
implementation files('libs/bayessdk.jar')
implementation 'com.android.support:support-v4:28.0.0'
```

```
为了适配穿山甲SDK下载和安装相关功能，在工程中引用的包 com.android.support:support-v4:24.2.0 
使用24.2.0以及以上版本。
```

## 2.SDK相关权限配置

```Xml
<uses-permission android:name="android.permission.INTERNET" />
<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
<uses-permission android:name="android.permission.ACCESS_WIFI_STATE" />
<uses-permission android:name="android.permission.READ_PHONE_STATE" />
<uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />
<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />    <!-- 如果需要精确定位的话请加上此权限 -->
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.REQUEST_INSTALL_PACKAGES" />
<!--穿山甲相关-->
<uses-permission android:name="android.permission.GET_TASKS"/>
<!-- 如果有视频相关的广告且使用textureView播放，请务必添加，否则黑屏 -->
<uses-permission android:name="android.permission.WAKE_LOCK" />

```

## 3.AndroidManifest.xml配置

如果您打包 App 时的 targetSdkVersion >= 28：在AndroidManifest.xml 添加依赖声明 `uses-library android:name="org.apache.http.legacy" android:required="false"`
在application标签中添加 `android:usesCleartextTraffic="true"`，否则 SDK 无法工作，接入代码示例如下：

```xml
<application
    android:name=".DemoApplication"
    android:icon="@drawable/gdticon"
    android:label="@string/app_name"
    android:theme="@style/AppTheme"
    android:usesCleartextTraffic="true">

    <uses-library
        android:name="org.apache.http.legacy"
        android:required="false" />
    ... ...
  </application>
```

在AndroidManifest.xml中注册SDK相关的Activity和Service:

```xml
<!--广点通-->
<service 
    android:name="com.qq.e.comm.DownloadService" 
    android:exported="false" />
<activity 
    android:name="com.qq.e.ads.ADActivity" 
    android:configChanges="keyboard|keyboardHidden|orientation|screenSize" />
<activity 
    android:name="com.qq.e.ads.PortraitADActivity" 
    android:screenOrientation="portrait" 
    android:configChanges="keyboard|keyboardHidden|orientation|screenSize" />
<activity 
    android:name="com.qq.e.ads.LandscapeADActivity" 
    android:screenOrientation="landscape" 
    android:configChanges="keyboard|keyboardHidden|orientation|screenSize" />
<!--倍业-->
<activity
    android:name="com.bayescom.sdk.BayesActivity"
    android:configChanges="keyboard|keyboardHidden|orientation|screenSize" />
<service android:name="com.bayescom.sdk.BayesDownloadService" />

```

针对Andriod7.0以上文件访问兼容性配置，在AndroidManifest.xml中增加：

```xml
<!--穿山甲-->
<provider
    android:name="com.bytedance.sdk.openadsdk.TTFileProvider"
    android:authorities="${applicationId}.TTFileProvider"
    android:exported="false"
    android:grantUriPermissions="true">
   <meta-data
        android:name="android.support.FILE_PROVIDER_PATHS"
        android:resource="@xml/file_paths" />
</provider>
<provider
    android:name="com.bytedance.sdk.openadsdk.multipro.TTMultiProvider"
    android:authorities="${applicationId}.TTMultiProvider"
    android:exported="false" />
<!--广点通，倍业-->
 <provider
        android:name="android.support.v4.content.FileProvider"
        android:authorities="${applicationId}.fileprovider"
        android:exported="false"
        android:grantUriPermissions="true">
        <meta-data
            android:name="android.support.FILE_PROVIDER_PATHS"
            android:resource="@xml/file_path" />
    </provider>
```

在res/xml目录下，新建穿山甲xml文件file_paths.xml，在该文件中添加如下代码：

```xml
<?xml version="1.0" encoding="utf-8"?>  
<paths xmlns:android="http://schemas.android.com/apk/res/android">  
   <external-files-path name="external_files_path" path="Download" />  
    <!--为了适配所有路径可以设置 path = "." -->  
</paths>
```

在res/xml目录下，新建广点通，倍业file_path.xml,在文件中添加如下代码:

```xml
<paths xmlns:android="http://schemas.android.com/apk/res/android">
    <!-- 这个下载路径也不可以修改，必须为GDTDOWNLOAD -->
    <external-path
        name="gdt_sdk_download_path"
        path="GDTDOWNLOAD" />
    <external-files-path
        name="external_files_path"
        path="Download" />
    <external-path
        name="download"
        path="." />
    <external-cache-path
        name="gdt_sdk_download_path1"
        path="com_qq_e_download" />
    <cache-path
        name="gdt_sdk_download_path2"
        path="com_qq_e_download" />
</paths>
```

## 4.代码混淆配置

如果您需要使用proguard混淆代码，需确保不要混淆SDK的代码。 请在proguard.cfg文件(或其他混淆文件)尾部添加如下配置:

```
-keep class com.bytedance.sdk.openadsdk.** { *; }
-keep public interface com.bytedance.sdk.openadsdk.downloadnew.** {*;}
-keep class com.ss.sys.ces.* {*;}
-keep class com.bayescom.sdk.**{
  public protected *;
}
-keep class com.qq.e.** { 
    public protected *; 
}
-keep class android.support.v4.app.NotificationCompat**{
    public *;
}
-dontwarn  com.bayescom.sdk.**
-keepclassmembers class * extends android.webkit.WebViewClient {
     public void *(android.webkit.WebView,java.lang.String,android.graphics.Bitmap);
     public boolean *(android.webkit.WebView,java.lang.String);
}
-keepclassmembers class * extends android.webkit.WebChromeClient {
     public void *(android.webkit.WebView,java.lang.String);
}
-keep class android.webkit.** {
    *;
}
```